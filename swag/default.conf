## Version 2018/04/20 - Changelog: https://github.com/linuxserver/docker-letsencrypt/commits/master/root/defaults/default

################################################################################
#### PORT 80 ACTIVE ############################################################
# listening on port 80 disabled by default, remove the "#" signs to enable
# redirect all traffic to https
server {
	listen 80 default_server;
	listen [::]:80 default_server;
	server_name *.turel.cloud;
	return 301 https://$host$request_uri;
}
################################################################################
################################################################################

# main server block
server {
	listen 443 ssl default_server;

	root /config/www;
	index index.html index.htm index.php;

	server_name turel.cloud;

	# enable subfolder method reverse proxy confs
	include /config/nginx/proxy-confs/*.subfolder.conf;

	# all ssl related config moved to ssl.conf
	include /config/nginx/ssl.conf;

	client_max_body_size 0;

	location ~ \.php$ {
          # enable for Authelia
          #include /config/nginx/authelia-location.conf;
          set $upstream_app heimdall;
          set $upstream_port 443;
          set $upstream_proto https;
          proxy_pass $upstream_proto://$upstream_app:$upstream_port;
	}
}

######### HOMEASSISTANT ##############################################################
server {
    listen 443 ssl;
    listen [::]:443 ssl;

	server_name ha.*;

	include /config/nginx/ssl.conf;

	client_max_body_size 0;

	location / {
		include /config/nginx/proxy.conf;
		resolver 127.0.0.11 valid=30s;
        set $upstream_app homeassistant;
        set $upstream_port 8123;
        set $upstream_proto http;
        proxy_pass http://10.0.0.2:8123;		
	}
}

server {
    listen 443 ssl;
    listen [::]:443 ssl;

	server_name hass.turel.cloud;

	include /config/nginx/ssl.conf;

	client_max_body_size 0;

	location / {
		include /config/nginx/proxy.conf;
		proxy_pass http://10.0.0.2:8123;
	}
}


### SUBDOMAIN Dozzle ###############################################################
server {
    listen 443 ssl;
    listen [::]:443 ssl;

	server_name dozzle.turel.cloud;

	include /config/nginx/ssl.conf;

	client_max_body_size 0;

    # enable for Authelia
	include /config/nginx/authelia-server.conf;

	location / {
        # enable for Authelia
		include /config/nginx/authelia-location.conf;

		include /config/nginx/proxy.conf;
		resolver 127.0.0.1 valid=30s;
		proxy_pass http://10.0.0.2:9999;
	}
}

### SUBDOMAIN adguard ###############################################################
server {
    listen 443 ssl;
    listen [::]:443 ssl;

	server_name adguard.turel.cloud;

	include /config/nginx/ssl.conf;

	client_max_body_size 0;

    # enable for Authelia
	include /config/nginx/authelia-server.conf;

	location / {
        # enable for Authelia
		include /config/nginx/authelia-location.conf;

		include /config/nginx/proxy.conf;
		resolver 127.0.0.1 valid=30s;
		proxy_pass http://10.0.0.2:8123/hassio/ingress/a0d7b954_adguard;
	}
}

################################################################################
### SUBDOMAIN nodered ##################################################################
server {
	listen 443 ssl;
    listen [::]:443 ssl;

    server_name nodered.turel.cloud;

	include /config/nginx/ssl.conf;

	client_max_body_size 0;

	location / {
#		auth_basic "Restricted";
#		auth_basic_user_file /config/nginx/.htpasswd;
		include /config/nginx/proxy.conf;
		proxy_pass http://10.0.0.2:1880;
	}
}

################################################################################
### SUBDOMAIN Bitwarden ##################################################################
server {
    listen 443 ssl;
    listen [::]:443 ssl;

	server_name pass.turel.cloud;

	include /config/nginx/ssl.conf;

	client_max_body_size 0;

	location / {
#		auth_basic "Restricted";
#		auth_basic_user_file /config/nginx/.htpasswd;
		include /config/nginx/proxy.conf;
		proxy_pass https://10.0.0.2:7277;
	}
}

### SUBDOMAIN vacuum ###############################################################
server {
    listen 443 ssl;
    listen [::]:443 ssl;

	server_name vacuum.turel.cloud;

	include /config/nginx/ssl.conf;

	client_max_body_size 0;

    # enable for Authelia
	include /config/nginx/authelia-server.conf;

	location / {
        # enable for Authelia
		include /config/nginx/authelia-location.conf;

		include /config/nginx/proxy.conf;
		resolver 127.0.0.1 valid=30s;
		proxy_pass http://10.0.0.30;
	}
}

### SUBDOMAIN pi2 ###############################################################
server {
    listen 443 ssl;
    listen [::]:443 ssl;

	server_name pi2.turel.cloud;

	include /config/nginx/ssl.conf;

	client_max_body_size 0;

    # enable for Authelia
#    include /config/nginx/authelia-server.conf;

    location / {
        # enable for Authelia
#        include /config/nginx/authelia-location.conf;

        #auth_basic "Restricted";
        #auth_basic_user_file /config/nginx/.htpasswd;
        include /config/nginx/proxy.conf;
        proxy_pass http://10.0.0.4:8123;
	}
}

### SUBDOMAIN pi3 ###############################################################
server {
    listen 443 ssl;
    listen [::]:443 ssl;

	server_name pi3.turel.cloud;

	include /config/nginx/ssl.conf;

	client_max_body_size 0;

    # enable for Authelia
#    include /config/nginx/authelia-server.conf;

    location / {
        # enable for Authelia
#        include /config/nginx/authelia-location.conf;

        #auth_basic "Restricted";
        #auth_basic_user_file /config/nginx/.htpasswd;
        include /config/nginx/proxy.conf;
        proxy_pass http://10.0.0.5:8123;
	}
}


### SUBDOMAIN mqtt  ##################################################################
#server {
#    listen 443 ssl;
#    listen [::]:443 ssl;

#        server_name mqtt.turkel.duckdns.org;

#        include /config/nginx/ssl.conf;

#        client_max_body_size 0;

#        location / {
#                proxy_pass http://10.0.0.2:1884;
#                proxy_pass http://websocket;
#                proxy_http_version 1.1;
#                proxy_set_header Upgrade $http_upgrade;
#                proxy_set_header Connection $connection_upgrade;
#                proxy_set_header Host $host;
#               auth_basic "Restricted";
#               auth_basic_user_file /config/nginx/.htpasswd;
#                include /config/nginx/proxy.conf;
#                proxy_pass https://10.0.0.2:4883;
#        }
#}


### SUBDOMAIN kuma ###############################################################
server {
    listen 443 ssl;
    listen [::]:443 ssl;

	server_name kuma.turel.cloud;

	include /config/nginx/ssl.conf;

	client_max_body_size 0;

    # enable for Authelia
#    include /config/nginx/authelia-server.conf;

    location / {
        # enable for Authelia
#        include /config/nginx/authelia-location.conf;

        #auth_basic "Restricted";
        #auth_basic_user_file /config/nginx/.htpasswd;
        include /config/nginx/proxy.conf;
        proxy_pass http://10.0.0.2:3001;
	}
}
# enable subdomain method reverse proxy confs
include /config/nginx/proxy-confs/*.subdomain.conf;



